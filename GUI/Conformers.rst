Conformers
##########

.. _metatag CONFORMERS: 

The GUI has an option to handle multiple conformers of molecules. 

Conformers may be created using RDKit (see `www.rdkit.org <http://www.rdkit.org>`__) via AMSinput. 
There is now a Conformers job method (just like ADF, BAND, DFTB etc) that will show a panel with options to generate the conformers. 
The algorithm used by RDKit for conformer generation will only work properly for single molecules, and the proper connectivity needs to be present. 

After setting the proper options, just run the job like any other job. So it may also be running in the background.

The conformer geometries are stored in an .sdf file. This is in principle a series of xyz structures, with bond information and some other data. 
The energy is stored in the comment line, and in the extra fields there is also information like what program calculated the energy, 
and sometimes a pointer to the matching input file (.ams file) and results file (.t21 file).

You can use AMSmovie to open the .sdf file and see the molecules in there. Open the Energy Graph in AMSmovie to get a graph of the corresponding energies. 

With AMSinput you can set up your calculation as usual (single point, geometry optimization, or anything else). 
In the Coordinates panel (in the Model section) you can specify that you want to use the molecules from the .sdf file 
(Use Selected File, and specify the .sdf file generated by the Conformers job).
You can select what entries to use from the .sdf file using the SDF Filter panel (click on the ... button after Use Selected File, or go to the SDF Filters panel in the Details
section directly). You can filter based on count or energy. In this panel you can also select what post-processing options will be applied to new sdf files generated 
by a calculation.

When you save your setup in AMSinput, a run script is created that will execute your job for all the conformers. 
Results of the individual calculations will be saved in the .results directory, and the original .sdf file will also be put there (with a time stamp). 
After running a new .sdf file will be created that has the results of the calculations, 
with pointers to the result files. Technically this is done using amsprep and amsreport in the run script. 

Based on this new sdf file you can now do other things, if you want. 
Thus you can chain a series of calculations, for example first optimizing with DFTB or MOPAC, next optimizing with ADF, and finally calculating some property with ADF. 

If you have calculated some spectrum (IR, NMR, UV/Vis) for all conformers in this way, you can visualize the averaged spectrum via AMSspectra. 
If it finds an .sdf file with the job, it will use it and the pointers in it to calculate averaged spectra. 
In AMSspectra there will be extra controls on how this averaging is done, most importantly the Temperature. 
In the View menu in AMSspectra you can also show all individual spectra, put together in one plot.

As the individual result files are present in the results directory, you can also visualize results from any specific conformer by selecting that t21 result file in AMSjobs, 
and then using the tools in the SCM menu as usual. 

