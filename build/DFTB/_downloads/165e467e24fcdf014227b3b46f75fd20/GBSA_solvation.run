#!/bin/sh


# 1. Test: Correct geometry in solution. Proton should stay where it is.
# ======================================================================

AMS_JOBNAME=insolution $AMSBIN/ams << eor

Task GeometryOptimization

GeometryOptimization
   Convergence Step=1.0e-3
End

System
    Atoms
        C -2.952658582657874 0.04645901178988775 -0.2265370925256049
        C -1.525681082568581 -0.0632256145142199 0.3253833614393568
        C -0.8702309998044314 1.320132595321299 0.4237615743177286
        C -1.51274965669442 -0.7747515748731322 1.675623541214415
        N -0.7585531160264641 -0.8002764137525281 -0.685002445614226
        C -0.125815059541938 -1.888404876006561 -0.5619452224652126
        H 0.3933316241384404 -2.297780064591292 -1.420796950876057
        Cl -0.6405638449575868 0.3711605263839059 -3.386878242415801
        H -0.07954642621561822 -2.433755645332853 0.3716143879666342
        H 0.1593861124853071 1.224674178285476 0.7663389629840952
        H -1.425551586480803 1.930381023229107 1.134028455207074
        H -0.8766051564206533 1.814252585786801 -0.5466890218510505
        H -3.562314031052068 0.6219838361677803 0.4680147715674572
        H -3.387932028293341 -0.9453294765130141 -0.3430211448005557
        H -2.950029479645555 0.5481307479235709 -1.193069533171342
        H -0.4972001484798669 -0.8666401271795375 2.059424124249443
        H -1.960500983176193 -1.765112626081995 1.59927019965761
        H -2.095961597315341 -0.1875167889244935 2.38340332667977
        H -0.7534711472929415 -0.3338452271177779 -1.625750861563839
    End
End

Engine DFTB
    Model GFN1-xTB
    Solvation Solvent=chcl3
EndEngine

eor
echo "N-H bond distance"
$AMSBIN/amsreport insolution.results/ams.rkf distance#5#19
echo "H-Cl distance"
$AMSBIN/amsreport insolution.results/ams.rkf distance#19#8


# 2. Test: Same with DFTB3
# ========================

AMS_JOBNAME=insolution_DFTB3 $AMSBIN/ams << eor

Task GeometryOptimization

GeometryOptimization
   Convergence Step=1.0e-3
End

System
    Atoms
        C -2.952658582657874 0.04645901178988775 -0.2265370925256049
        C -1.525681082568581 -0.0632256145142199 0.3253833614393568
        C -0.8702309998044314 1.320132595321299 0.4237615743177286
        C -1.51274965669442 -0.7747515748731322 1.675623541214415
        N -0.7585531160264641 -0.8002764137525281 -0.685002445614226
        C -0.125815059541938 -1.888404876006561 -0.5619452224652126
        H 0.3933316241384404 -2.297780064591292 -1.420796950876057
        Cl -0.6405638449575868 0.3711605263839059 -3.386878242415801
        H -0.07954642621561822 -2.433755645332853 0.3716143879666342
        H 0.1593861124853071 1.224674178285476 0.7663389629840952
        H -1.425551586480803 1.930381023229107 1.134028455207074
        H -0.8766051564206533 1.814252585786801 -0.5466890218510505
        H -3.562314031052068 0.6219838361677803 0.4680147715674572
        H -3.387932028293341 -0.9453294765130141 -0.3430211448005557
        H -2.950029479645555 0.5481307479235709 -1.193069533171342
        H -0.4972001484798669 -0.8666401271795375 2.059424124249443
        H -1.960500983176193 -1.765112626081995 1.59927019965761
        H -2.095961597315341 -0.1875167889244935 2.38340332667977
        H -0.7534711472929415 -0.3338452271177779 -1.625750861563839
    End
End

Engine DFTB
    Model DFTB3
    ResourcesDir DFTB.org/3ob-3-1
    DispersionCorrection D3-BJ
    Solvation Solvent=chcl3
EndEngine

eor
echo "N-H bond distance"
$AMSBIN/amsreport insolution_DFTB3.results/ams.rkf distance#5#19
echo "H-Cl distance"
$AMSBIN/amsreport insolution_DFTB3.results/ams.rkf distance#19#8


# 3. Test: No solvation model. Proton should move to the Cl.
# ==========================================================

AMS_JOBNAME=invacuum $AMSBIN/ams << eor

Task GeometryOptimization

GeometryOptimization
   Convergence Step=1.0e-3
End

System
    Atoms
        C -2.952658582657874 0.04645901178988775 -0.2265370925256049
        C -1.525681082568581 -0.0632256145142199 0.3253833614393568
        C -0.8702309998044314 1.320132595321299 0.4237615743177286
        C -1.51274965669442 -0.7747515748731322 1.675623541214415
        N -0.7585531160264641 -0.8002764137525281 -0.685002445614226
        C -0.125815059541938 -1.888404876006561 -0.5619452224652126
        H 0.3933316241384404 -2.297780064591292 -1.420796950876057
        Cl -0.6405638449575868 0.3711605263839059 -3.386878242415801
        H -0.07954642621561822 -2.433755645332853 0.3716143879666342
        H 0.1593861124853071 1.224674178285476 0.7663389629840952
        H -1.425551586480803 1.930381023229107 1.134028455207074
        H -0.8766051564206533 1.814252585786801 -0.5466890218510505
        H -3.562314031052068 0.6219838361677803 0.4680147715674572
        H -3.387932028293341 -0.9453294765130141 -0.3430211448005557
        H -2.950029479645555 0.5481307479235709 -1.193069533171342
        H -0.4972001484798669 -0.8666401271795375 2.059424124249443
        H -1.960500983176193 -1.765112626081995 1.59927019965761
        H -2.095961597315341 -0.1875167889244935 2.38340332667977
        H -0.7534711472929415 -0.3338452271177779 -1.625750861563839
    End
End

Engine DFTB
    Model GFN1-xTB
EndEngine

eor
echo "N-H bond distance"
$AMSBIN/amsreport invacuum.results/ams.rkf distance#5#19
echo "H-Cl distance"
$AMSBIN/amsreport invacuum.results/ams.rkf distance#19#8
