

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
<META name="ROBOTS" content="NOINDEX, NOFOLLOW">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>scm.plams.interfaces.adfsuite.ams &mdash; PLAMS 2021.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/css/theme_tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/panels-bootstrap.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="PLAMS 2021.1 documentation" href="../../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../../index.html"/> 

  
  <script src="../../../../../_static/js/jquery.min.js"></script>
  <script src="../../../../../_static/js/bootstrap.min.js"></script>
  <script src="../../../../../_static/js/modernizr.min.js"></script>
  <script src="../../../../../_static/js/app.js"></script>
<script type="text/javascript">
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NCRWHZZ');</script>
<!-- End Google Tag Manager -->

</head>

<body class="wy-body-for-nav" role="document">
  <!--STARTNOSOLR-->
  <header class="site-header navbar-fixed-top compact">
      <nav class="main navbar navbar-default">
        <div class="headerbar_container">
          <a role="button" href="/free-trial/" class="btn btn-sm btn-primary">Free trial</a>
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <div class="navbar-brand">
              <a class="logo" href="https://www.scm.com">
                <img class="logo-small" src="https://www.scm.com/wp-content/themes/scm/images/logos/scm-logo-compact.svg" alt="Software for Chemistry &amp; Materials" />
                <img class="logo-full" src="https://www.scm.com/wp-content/themes/scm/images/logos/scm-logo.svg" alt="Software for Chemistry &amp; Materials" />
              </a>
            </div>
          </div>
          <div class="nav-wrapper">
            <div class="collapse navbar-collapse">
              <ul id="menu-primary-navigation" class="nav navbar-nav"><li id="menu-item-40077" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-40077"><a title="Applications" href="https://www.scm.com/applications/">Applications</a></li>
<li id="menu-item-35" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35"><a title="Products" href="https://www.scm.com/amsterdam-modeling-suite/">Products</a></li>
<li id="menu-item-36" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36"><a title="Support" href="https://www.scm.com/support/">Support</a></li>
<li id="menu-item-37" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37"><a title="About us" href="https://www.scm.com/about-us/">About us</a></li>
</ul>                           <span class="search"><a class="menu_search_link" href="https://www.scm.com/search.php"></a><span class="sr-only">Search</span></span>
            </div>
          </div>
        </div>
      </nav>
 </header>
    

   
  <div id="doc-wrapper">
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html">
          

          
            
            <img src="../../../../../_static/plams_logo.png" class="logo" />
          
          </a>

          
          
  <ul>
      <li class="wy-breadcrumbs-aside">
        
           
           
        
      </li>
  </ul>
 
<!--ENDNOSOLR-->
             <!--STARTNOSOLR-->
<div role="search">
  <form id="rtd-search-form" class="wy-form search-docs-form" action="https://www.scm.com/search.php" method="get">
  <div class="input-group">
    <input type="text" name="search" placeholder="Search PLAMS" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
    <input type="hidden" name="root" value="doctrunk" />


    <input type="hidden" name="cat" value="doc-scripting" />


    <span class="input-group-btn">
			<button type="submit" class="btn btn-primary"><span class="sr-only">Search</span><span class="fa fa-search"></span></button>
		</span>
	</div>
  </form>
</div>
<!--ENDNOSOLR-->
          

          
        </div>
<!--STARTNOSOLR-->
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../intro.html#what-is-plams">What is PLAMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../intro.html#what-can-be-done-with-plams">What can be done with PLAMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../intro.html#simple-example">Simple example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../intro.html#what-plams-is-not">What PLAMS is <em>not</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../intro.html#about-this-documentation">About this documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../started.html#library-contents">Library contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../started.html#installing-plams">Installing PLAMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../started.html#updating-plams">Updating PLAMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../started.html#running-plams">Running PLAMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../started.html#defaults-file">Defaults file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../started.html#the-launch-script">The launch script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../started.html#working-folder-location">Working folder location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../started.html#passing-variables">Passing variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../started.html#importing-past-jobs">Importing past jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../started.html#restarting-failed-script">Restarting failed script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../started.html#multiple-input-scripts">Multiple input scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../components/components.html">Components overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/settings.html">Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/settings.html#tree-like-structure">Tree-like structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/settings.html#dot-notation">Dot notation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/settings.html#case-sensitivity">Case sensitivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/settings.html#global-settings">Global settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/settings.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/jobs.html">Jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobs.html#preparing-a-job">Preparing a job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#contents-of-job-settings">Contents of job settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#default-settings">Default settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobs.html#running-a-job">Running a job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#name-conflicts">Name conflicts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#prerun-and-postrun-methods">Prerun and postrun methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#preview-mode">Preview mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobs.html#job-api">Job API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobs.html#single-jobs">Single jobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#subclassing-singlejob">Subclassing SingleJob</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobs.html#multijobs">Multijobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/jobs.html#using-multijob">Using MultiJob</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/results.html">Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/results.html#files-in-the-job-folder">Files in the job folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/results.html#synchronization-of-parallel-job-executions">Synchronization of parallel job executions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/results.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/results.html#cleaning-job-folder">Cleaning job folder</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/results.html#cleaning-for-multijobs">Cleaning for multijobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/results.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/runners.html">Job runners</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/runners.html#local-job-runner">Local job runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/runners.html#remote-job-runner">Remote job runner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/jobmanager.html">Job manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobmanager.html#rerun-prevention">Rerun prevention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobmanager.html#pickling">Pickling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobmanager.html#restarting-scripts">Restarting scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/jobmanager.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/functions.html">Public functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/functions.html#logging">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/functions.html#binding-decorators">Binding decorators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/molecule.html">Molecule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/mol_api.html">Molecule</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/mol_api.html#atom-labeling">Atom labeling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/atombond.html">Atom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/atombond.html#bond">Bond</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/mol_rdkit.html">RDKit interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/mol_ase.html">ASE interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/utils.html">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/utils.html#periodic-table">Periodic Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/utils.html#units">Units</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/utils.html#geometry-tools">Geometry tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/utils.html#file-format-conversion-tools">File format conversion tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../components/trajectories.html">Trajectories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/xyz.html">XYZ trajectory files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/xyz.html#xyz-history-files">XYZ history files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/rkf.html">RKF trajectory files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../components/rkf.html#rkf-history-files">RKF history files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../components/dcd.html">DCD trajectory files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../interfaces/interfaces.html">Interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../interfaces/amssuite.html">Amsterdam Modeling Suite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/ams.html">AMS driver and engines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/ams.html#preparing-input">Preparing input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/ams.html#preparing-runscript">Preparing runscript</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/ams.html#molecule-handling">Molecule handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/ams.html#amsjob-api">AMSJob API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/ams.html#amsresults-api">AMSResults API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/amsworker.html">AMS worker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/amsworker.html#amsworker-api">AMSWorker API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/amsworker.html#amsworkerresults-api">AMSWorkerResults API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/amsworker.html#amsworkerpool-api">AMSWorkerPool API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/postadf.html">Analysis tools: Densf, FCF, analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/kffiles.html">KF files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/crs.html">COSMO-RS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crs.html#settings">Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crs.html#settings-with-multiple-compound">Settings with multiple compound</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crs.html#adf-and-crsjob">ADF and CRSJob</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crs.html#cosmo-rs-parameters">COSMO-RS Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crs.html#data-analyses-and-plotting">Data analyses and plotting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crs.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/adf.html">ADF (pre-2020 version)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/adf.html#preparing-input">Preparing input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/adf.html#preparing-runscript">Preparing runscript</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/adf.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/reaxff.html">ReaxFF (pre-2019 version)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../interfaces/thirdparty.html">Other programs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/cp2k.html">CP2K</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/cp2k.html#settings">Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/cp2k.html#molecule-parsing">Molecule parsing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/cp2k.html#loading-jobs">Loading jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/cp2k.html#molecule-loading">Molecule loading</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/cp2k.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/crystal.html">Crystal</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crystal.html#preparing-a-calculation">Preparing a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crystal.html#molecule-parsing">Molecule parsing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crystal.html#results-extraction">Results extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crystal.html#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/crystal.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/dftbplus.html">DFTB+</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dftbplus.html#preparing-a-calculation">Preparing a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dftbplus.html#results-extraction">Results extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dftbplus.html#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dftbplus.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/dirac.html">Dirac</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dirac.html#preparing-a-calculation">Preparing a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dirac.html#results-extraction">Results extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/dirac.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/mopac.html">MOPAC (standalone program)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/mopac.html#preparing-input">Preparing input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/mopac.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/orca.html">ORCA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/orca.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../interfaces/raspa.html">RASPA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/raspa.html#input">Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/raspa.html#molecule-parsing">Molecule parsing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/raspa.html#loading-jobs">Loading jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../interfaces/raspa.html#api">API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../examples/examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/examples.html#id1">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/He2DissociationCurve.html">Helium dimer dissociation curve</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/WaterOptimization.html">Geometry optimization of water</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/ManyJobsInParallel.html">Many jobs in parallel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/BasisSetBenchmark.html">Benchmark accuracy of basis sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/ExcitationsWorkflow.html">Workflow: filtering molecules based on excitation energies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/ChargeTransferIntegralsADF.html">Charge transfer integrals with ADF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/gammascan.html">Tuning the range separation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../examples/examples.html#pre-made-recipes">Pre-made recipes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/ams_crs.html">ADF and COSMO-RS workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/adffragment.html">ADF fragment job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/ReorganizationEnergy.html">Reorganization Energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/adfnbo.html">NBO with ADF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/numgrad.html">Numerical gradients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/numhess.html">Numerical Hessian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/molecule_gun.html">ReaxFF molecule gun</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/global_minimum.html">Global Minimum Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../examples/vibrationASE.html">Vibrational analysis with ASE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../examples/vibrationASE.html#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../examples/vibrationASE.html#api">API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cookbook/cookbook.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../cookbook/cookbook.html#settings-and-input">Settings and input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#create-an-input-block-with-an-header">Create an input block with an header</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#create-an-empty-input-block">Create an empty input block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#convert-an-ams-text-input-into-an-ams-job">Convert an AMS text input into an AMS job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#convert-an-ams-text-input-into-settings-object">Convert an AMS text input into settings object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#convert-an-ams-run-file-into-an-amsjob">Convert an AMS .run file into an AMSJob</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#specify-paths-to-files-in-the-input">Specify paths to files in the input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#restart-from-a-previous-job">Restart from a previous job</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../cookbook/cookbook.html#molecules">Molecules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#generate-a-molecule-from-a-smiles-string">Generate a molecule from a SMILES string</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#counting-rings">Counting rings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../cookbook/cookbook.html#extracting-results">Extracting Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#directly-from-functions">Directly from Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../cookbook/cookbook.html#examples-total-energy-and-final-structure">Examples: Total Energy and Final Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../cookbook/cookbook.html#amsresults-api-functions">AMSResults API Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#from-the-rkf-interface">From the RKF Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#finding-section-variable-pairs">Finding Section/Variable Pairs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../cookbook/cookbook.html#from-python-directories">From Python Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../cookbook/cookbook.html#kfbrowser">KFBrowser</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#from-molecular-dynamics-trajectories">From molecular dynamics trajectories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../cookbook/cookbook.html#general-md-properties">General MD properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../cookbook/cookbook.html#molecules-from-trajectories">Molecules from trajectories</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../cookbook/cookbook.html#accessing-old-jobs">Accessing Old Jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#binding-native-plams-jobs">Binding Native PLAMS Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../cookbook/cookbook.html#binding-old-rkf-files">Binding old RKF Files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../citations.html">Citations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../index.html">PLAMS</a>
      </nav>
<!--ENDNOSOLR-->

      
      <div class="wy-nav-content">
        <div class="rst-content">
        <!--STARTNOSOLR-->
<div class="header" role="navigation" aria-label="breadcrumbs navigation">
 
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../PLAMS.html/../../Documentation/index.html">Documentation</a>/</li>
    <li><a href="../../../../../index.html">PLAMS</a>/</li>
      
          <li><a href="../../../../index.html">Module code</a>/</li>
      
    <li class="orange-text">scm.plams.interfaces.adfsuite.ams</li>
  </ul>
  <p>
 
</div>
<!--ENDNOSOLR-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for scm.plams.interfaces.adfsuite.ams</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">opj</span>

<span class="kn">from</span> <span class="nn">...core.basejob</span> <span class="k">import</span> <span class="n">SingleJob</span>
<span class="kn">from</span> <span class="nn">...core.errors</span> <span class="k">import</span> <span class="n">FileError</span><span class="p">,</span> <span class="n">JobError</span><span class="p">,</span> <span class="n">ResultsError</span><span class="p">,</span> <span class="n">PTError</span>
<span class="kn">from</span> <span class="nn">...core.functions</span> <span class="k">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">parse_heredoc</span>
<span class="kn">from</span> <span class="nn">...core.private</span> <span class="k">import</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">UpdateSysPath</span>
<span class="kn">from</span> <span class="nn">...core.results</span> <span class="k">import</span> <span class="n">Results</span>
<span class="kn">from</span> <span class="nn">...core.settings</span> <span class="k">import</span> <span class="n">Settings</span>
<span class="kn">from</span> <span class="nn">...mol.molecule</span> <span class="k">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">...mol.atom</span> <span class="k">import</span> <span class="n">Atom</span>
<span class="kn">from</span> <span class="nn">...mol.bond</span> <span class="k">import</span> <span class="n">Bond</span>
<span class="kn">from</span> <span class="nn">...tools.kftools</span> <span class="k">import</span> <span class="n">KFFile</span>
<span class="kn">from</span> <span class="nn">...tools.units</span> <span class="k">import</span> <span class="n">Units</span>
<span class="kn">from</span> <span class="nn">...trajectories.rkffile</span> <span class="k">import</span> <span class="n">RKFTrajectoryFile</span>
<span class="kn">from</span> <span class="nn">...tools.converters</span> <span class="k">import</span> <span class="n">vasp_output_to_ams</span><span class="p">,</span> <span class="n">qe_output_to_ams</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">watchdog.observers</span> <span class="k">import</span> <span class="n">Observer</span>
    <span class="kn">from</span> <span class="nn">watchdog.events</span> <span class="k">import</span> <span class="n">PatternMatchingEventHandler</span><span class="p">,</span> <span class="n">FileModifiedEvent</span>
    <span class="n">_has_watchdog</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">class</span> <span class="nc">AMSJobLogTailHandler</span><span class="p">(</span><span class="n">PatternMatchingEventHandler</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">jobmanager</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobmanager</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{job.name}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="s2">&quot;ams.log&quot;</span><span class="p">)],</span>
                             <span class="n">ignore_patterns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.rkf&quot;</span><span class="p">,</span> <span class="s2">&quot;*.out&quot;</span><span class="p">],</span>
                             <span class="n">ignore_directories</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_job</span> <span class="o">=</span> <span class="n">job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_seekto</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">on_any_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">src_path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;ams.log&quot;</span><span class="p">)</span> \
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">FileModifiedEvent</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">src_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seekto</span><span class="p">)</span>
                        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">break</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{self._job.name}</span><span class="s2">: &quot;</span><span class="o">+</span><span class="n">line</span><span class="p">[</span><span class="mi">25</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_seekto</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_seekto</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_has_watchdog</span> <span class="o">=</span> <span class="kc">False</span>



<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AMSJob&#39;</span><span class="p">,</span> <span class="s1">&#39;AMSResults&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="AMSResults"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults">[docs]</a><span class="k">class</span> <span class="nc">AMSResults</span><span class="p">(</span><span class="n">Results</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A specialized |Results| subclass for accessing the results of |AMSJob|.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Results</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="AMSResults.collect"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Collect files present in the job folder. Use parent method from |Results|, then create an instance of |KFFile| for each ``.rkf`` file present in the job folder. Collect these files in ``rkfs`` dictionary, with keys being filenames without ``.rkf`` extension.</span>

<span class="sd">        The information about ``.rkf`` files generated by engines is taken from the main ``ams.rkf`` file.</span>

<span class="sd">        This method is called automatically during the final part of the job execution and there is no need to call it manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Results</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">rkfname</span> <span class="o">=</span> <span class="s1">&#39;ams.rkf&#39;</span>
        <span class="k">if</span> <span class="n">rkfname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="n">KFFile</span><span class="p">(</span><span class="n">opj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">rkfname</span><span class="p">))</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">main</span><span class="p">[(</span><span class="s1">&#39;EngineResults&#39;</span><span class="p">,</span><span class="s1">&#39;nEntries&#39;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span>  <span class="n">main</span><span class="p">[(</span><span class="s1">&#39;EngineResults&#39;</span><span class="p">,</span><span class="s1">&#39;Title(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))]</span>
                <span class="n">files</span> <span class="o">=</span>  <span class="n">main</span><span class="p">[(</span><span class="s1">&#39;EngineResults&#39;</span><span class="p">,</span><span class="s1">&#39;Files(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.rkf&#39;</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFFile</span><span class="p">(</span><span class="n">opj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">main</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="s1">&#39;WARNING: Main KF file </span><span class="si">{}</span><span class="s1"> not present in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rkfname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.refresh"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Refresh the contents of ``files`` list.</span>

<span class="sd">        Use the parent method from |Results|, then look at |KFFile| instances present in ``rkfs`` dictionary and check if they point to existing files. If not, try to reinstantiate them with current job path (that can happen while loading a pickled job after the entire job folder was moved).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Results</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                    <span class="n">guessnewpath</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">guessnewpath</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFFile</span><span class="p">(</span><span class="n">guessnewpath</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="AMSResults.engine_names"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.engine_names">[docs]</a>    <span class="k">def</span> <span class="nf">engine_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all names of engine specific ``.rkf`` files. The identifier of the main result file (``&#39;ams&#39;``) is not present in the returned list, only engine specific names are listed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;ams&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="AMSResults.rkfpath"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.rkfpath">[docs]</a>    <span class="k">def</span> <span class="nf">rkfpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute path of a chosen ``.rkf`` file.</span>

<span class="sd">        The *file* argument should be the identifier of the file to read. It defaults to ``&#39;ams&#39;``. To access a file called ``something.rkf`` you need to call this function with ``file=&#39;something&#39;``. If there exists only one engine results ``.rkf`` file, you can call this function with ``file=&#39;engine&#39;`` to access this file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_rkf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.readrkf"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.readrkf">[docs]</a>    <span class="k">def</span> <span class="nf">readrkf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read data from *section*/*variable* of a chosen ``.rkf`` file.</span>

<span class="sd">        The *file* argument should be the identifier of the file to read. It defaults to ``&#39;ams&#39;``. To access a file called ``something.rkf`` you need to call this function with ``file=&#39;something&#39;``. If there exists only one engine results ``.rkf`` file, you can call this function with ``file=&#39;engine&#39;`` to access this file.</span>

<span class="sd">        The type of the returned value depends on the type of *variable* defined inside KF file. It can be: single int, list of ints, single float, list of floats, single boolean, list of booleans or string.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If arguments *section* or *variable* are incorrect (not present in the chosen file), the returned value is ``None``. Please mind the fact that KF files are case sensitive.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_rkf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">variable</span><span class="p">),</span> <span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.read_rkf_section"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.read_rkf_section">[docs]</a>    <span class="k">def</span> <span class="nf">read_rkf_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with all variables from a given *section* of a chosen ``.rkf`` file.</span>

<span class="sd">        The *file* argument should be the identifier of the file to read. It defaults to ``&#39;ams&#39;``. To access a file called ``something.rkf`` you need to call this function with ``file=&#39;something&#39;``. If there exists only one engine results ``.rkf`` file, you can call this function with ``file=&#39;engine&#39;`` to access this file.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If *section* is not present in the chosen file, the returned value is an empty dictionary. Please mind the fact that KF files are case sensitive.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_rkf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read_section</span><span class="p">(</span><span class="n">section</span><span class="p">),</span> <span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_rkf_skeleton"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_rkf_skeleton">[docs]</a>    <span class="k">def</span> <span class="nf">get_rkf_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with the structure of a chosen ``.rkf`` file. Each key corresponds to a section name with the value being a set of variable names present in that section.</span>

<span class="sd">        The *file* argument should be the identifier of the file to read. It defaults to ``&#39;ams&#39;``. To access a file called ``something.rkf`` you need to call this function with ``file=&#39;something&#39;``. If there exists only one engine results ``.rkf`` file, you can call this function with ``file=&#39;engine&#39;`` to access this file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_rkf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_skeleton</span><span class="p">(),</span> <span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_molecule"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">get_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a |Molecule| instance stored in a given *section* of a chosen ``.rkf`` file.</span>

<span class="sd">        The *file* argument should be the identifier of the file to read. It defaults to ``&#39;ams&#39;``. To access a file called ``something.rkf`` you need to call this function with ``file=&#39;something&#39;``. If there exists only one engine results ``.rkf`` file, you can call this function with ``file=&#39;engine&#39;`` to access this file.</span>

<span class="sd">        All data used by this method is taken from the chosen ``.rkf`` file. The ``molecule`` attribute of the corresponding job is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sectiondict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_rkf_section</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sectiondict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">_mol_from_rkf_section</span><span class="p">(</span><span class="n">sectiondict</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_ase_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ase</span> <span class="k">import</span> <span class="n">Atoms</span>
        <span class="n">sectiondict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_rkf_section</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="n">bohr2angstrom</span> <span class="o">=</span> <span class="mf">0.529177210903</span>
        <span class="n">nLatticeVectors</span> <span class="o">=</span> <span class="n">sectiondict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nLatticeVectors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="n">nLatticeVectors</span> <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">nLatticeVectors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nLatticeVectors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sectiondict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LatticeVectors&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">cell</span><span class="p">[:</span><span class="n">lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lattice</span> <span class="o">*</span> <span class="n">bohr2angstrom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">atomsymbols</span> <span class="o">=</span> <span class="n">sectiondict</span><span class="p">[</span><span class="s1">&#39;AtomSymbols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sectiondict</span><span class="p">[</span><span class="s1">&#39;Coords&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">bohr2angstrom</span>
        <span class="k">return</span> <span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">atomsymbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="n">pbc</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>


<div class="viewcode-block" id="AMSResults.get_input_molecule"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_input_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a |Molecule| instance with the initial coordinates.</span>

<span class="sd">        All data used by this method is taken from ``ams.rkf`` file. The ``molecule`` attribute of the corresponding job is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="s1">&#39;InputMolecule&#39;</span><span class="p">,</span> <span class="s1">&#39;ams&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_main_molecule"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_main_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">get_main_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a |Molecule| instance with the final coordinates.</span>

<span class="sd">        All data used by this method is taken from ``ams.rkf`` file. The ``molecule`` attribute of the corresponding job is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="s1">&#39;Molecule&#39;</span><span class="p">,</span> <span class="s1">&#39;ams&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AMSResults.get_main_ase_atoms"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_main_ase_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_main_ase_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an ase.Atoms instance with the final coordinates.</span>

<span class="sd">        An alternative is to call toASE(results.get_main_molecule()) to convert a Molecule to ASE Atoms.</span>

<span class="sd">        All data used by this method is taken from ``ams.rkf`` file. The ``molecule`` attribute of the corresponding job is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ase_atoms</span><span class="p">(</span><span class="s1">&#39;Molecule&#39;</span><span class="p">,</span> <span class="s1">&#39;ams&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_history_molecule"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_history_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">get_history_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a |Molecule| instance with coordinates taken from a particular *step* in the ``History`` section of ``ams.rkf`` file.</span>

<span class="sd">        All data used by this method is taken from ``ams.rkf`` file. The ``molecule`` attribute of the corresponding job is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_stepnumber</span><span class="p">(</span><span class="n">main</span><span class="p">,</span><span class="n">step</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">return</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Coords(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span><span class="mi">3</span><span class="p">)]</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;SystemVersion(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
                <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_version</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ChemicalSystem(</span><span class="si">{system}</span><span class="s1">)&#39;</span><span class="p">)</span>
                <span class="n">molsrc</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;ChemicalSystem(</span><span class="si">{system}</span><span class="s1">)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_main_molecule</span><span class="p">()</span>
                <span class="n">molsrc</span> <span class="o">=</span> <span class="s1">&#39;Molecule&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ResultsError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Coordinates taken from &quot;History%Coords(</span><span class="si">{step}</span><span class="s1">)&quot; have incompatible length with molecule from </span><span class="si">{molsrc}</span><span class="s1"> section&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">at</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
                <span class="n">at</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;bohr&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;LatticeVectors(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
                <span class="n">lattice</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;LatticeVectors(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">),</span> <span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
                <span class="n">mol</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">lattice</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lattice</span><span class="p">),</span><span class="mi">3</span><span class="p">)]</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">((</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;Bonds.Index(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Bonds.Atoms(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Bonds.Orders(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">]):</span>
                <span class="n">mol</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Bonds.Index(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Bonds.Atoms(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
                <span class="n">orders</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Bonds.Orders(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="n">orders</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">mol</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span><span class="n">mol</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mol</span><span class="p">[</span><span class="n">atoms</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">orders</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">mol</span></div>

<div class="viewcode-block" id="AMSResults.is_valid_stepnumber"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.is_valid_stepnumber">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid_stepnumber</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the requested step number is in the results file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;History&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;History&#39; section not present in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="s1">&#39;nEntries&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Step </span><span class="si">{}</span><span class="s2"> not present in &#39;History&#39; section of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">main</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AMSResults.get_system_version"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_system_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_system_version</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine which Molecule version is requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;SystemVersion(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;SystemVersion(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;SystemVersionHistory&#39;</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;SystemVersionHistory&#39;</span><span class="p">,</span> <span class="s1">&#39;blockSize&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
                    <span class="n">blockSize</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;SystemVersionHistory&#39;</span><span class="p">,</span> <span class="s1">&#39;blockSize&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">blockSize</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">block</span> <span class="o">=</span> <span class="p">(</span><span class="n">version</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">blockSize</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">version</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">blockSize</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;SystemVersionHistory&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;SectionNum(</span><span class="si">{block}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">return_as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="n">offset</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">version</span>
        <span class="k">return</span> <span class="n">system</span></div>

<div class="viewcode-block" id="AMSResults.get_history_variables"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_history_variables">[docs]</a>    <span class="k">def</span> <span class="nf">get_history_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_section</span><span class="o">=</span><span class="s1">&#39;History&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Return a set of keynames stored in the specified history section of the ``ams.rkf`` file.</span>

<span class="sd">        The *history_section argument should be a string representing the name of the history section (``History`` or ``MDHistory``)*&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span>
        <span class="n">keylist</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">sec</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="n">main</span> <span class="k">if</span> <span class="n">sec</span><span class="o">==</span><span class="n">history_section</span><span class="p">]</span>
        <span class="c1"># Now throw out all the last parts</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="AMSResults.get_history_property"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_history_property">[docs]</a>    <span class="k">def</span> <span class="nf">get_history_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">history_section</span><span class="o">=</span><span class="s1">&#39;History&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Return the values of *varname* in the history section *history_section*.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span><span class="k">return</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">history_section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;The requested section &#39;</span><span class="si">{history_section}</span><span class="s2">&#39; does not exist in </span><span class="si">{main.path}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;nScanCoord&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span> <span class="c1"># PESScan</span>
            <span class="n">nentries</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;nScanCoord&#39;</span><span class="p">)</span>
            <span class="n">as_block</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;nEntries&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
            <span class="n">nentries</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;nEntries&#39;</span><span class="p">)</span>
            <span class="n">as_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_stored_as_blocks</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">history_section</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_block</span> <span class="p">:</span>
            <span class="n">nblocks</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;nBlocks&#39;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{varname}</span><span class="s2">(</span><span class="si">{iblock}</span><span class="s2">)&quot;</span><span class="p">,</span><span class="n">return_as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">iblock</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nblocks</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">blockvals</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">blockvals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blockvals</span><span class="p">,</span><span class="nb">list</span><span class="p">)]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{varname}</span><span class="s2">(</span><span class="si">{step}</span><span class="s2">)&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nentries</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="AMSResults.get_property_at_step"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_property_at_step">[docs]</a>    <span class="k">def</span> <span class="nf">get_property_at_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">history_section</span><span class="o">=</span><span class="s1">&#39;History&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Return the value of *varname* in the history section *history_section at step *step*.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span>
        <span class="n">as_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_stored_as_blocks</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">history_section</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_block</span> <span class="p">:</span>
            <span class="kn">import</span> <span class="nn">numpy</span>
            <span class="n">blocksize</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;blockSize&#39;</span><span class="p">)</span>
            <span class="n">iblock</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">step</span><span class="o">/</span><span class="n">blocksize</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{varname}</span><span class="s2">(</span><span class="si">{iblock}</span><span class="s2">)&quot;</span><span class="p">)[(</span><span class="n">step</span><span class="o">%</span><span class="n">blocksize</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{varname}</span><span class="s2">(</span><span class="si">{step}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="k">def</span> <span class="nf">_values_stored_as_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">history_section</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Determines wether the values of varname in a trajectory rkf file are stored in blocks&quot;&quot;&quot;</span>
        <span class="n">nentries</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">history_section</span><span class="p">,</span><span class="s1">&#39;nEntries&#39;</span><span class="p">)</span>
        <span class="n">as_block</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">keylist</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">sec</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="n">main</span> <span class="k">if</span> <span class="n">sec</span><span class="o">==</span><span class="n">history_section</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;nBlocks&#39;</span> <span class="ow">in</span> <span class="n">keylist</span> <span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{varname}</span><span class="s2">(</span><span class="si">{nentries}</span><span class="s2">)&quot;</span> <span class="ow">in</span> <span class="n">keylist</span> <span class="p">:</span>
                <span class="n">as_block</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">as_block</span>

<div class="viewcode-block" id="AMSResults.get_atomic_temperatures_at_step"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_atomic_temperatures_at_step">[docs]</a>    <span class="k">def</span> <span class="nf">get_atomic_temperatures_at_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">history_section</span><span class="o">=</span><span class="s1">&#39;MDHistory&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the atomic temperatures for step `step`</span>

<span class="sd">        Note: Numbering of steps starts at 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_stepnumber</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span>

        <span class="c1"># Read the masses</span>
        <span class="n">molname</span> <span class="o">=</span> <span class="s1">&#39;Molecule&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;SystemVersion(</span><span class="si">{step}</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">main</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_version</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">molname</span> <span class="o">=</span> <span class="s1">&#39;ChemicalSystem(</span><span class="si">%i</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molname</span><span class="p">,</span><span class="s1">&#39;AtomMasses&#39;</span><span class="p">))</span>
        <span class="n">nats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">masses</span><span class="p">)</span>

        <span class="c1"># Read the velocities</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_property_at_step</span><span class="p">(</span><span class="n">step</span><span class="p">,</span><span class="s1">&#39;Velocities&#39;</span><span class="p">,</span><span class="n">history_section</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nats</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

        <span class="c1"># Convert to SI units and compute temperatures</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">masses</span> <span class="o">*</span> <span class="mf">1.e-3</span> <span class="o">/</span> <span class="n">Units</span><span class="o">.</span><span class="n">constants</span><span class="p">[</span><span class="s1">&#39;NA&#39;</span><span class="p">]</span>
        <span class="n">vels</span> <span class="o">=</span> <span class="n">velocities</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;Bohr&#39;</span><span class="p">,</span><span class="s1">&#39;Angstrom&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.e5</span>
        <span class="n">temperatures</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nats</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">vels</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">temperatures</span> <span class="o">/=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">constants</span><span class="p">[</span><span class="s1">&#39;k_B&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">temperatures</span></div>

<div class="viewcode-block" id="AMSResults.get_engine_results"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_engine_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_engine_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with contents of ``AMSResults`` section from an engine results ``.rkf`` file.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read_section</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_engine_properties"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_engine_properties">[docs]</a>    <span class="k">def</span> <span class="nf">get_engine_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with all the entries from ``Properties`` section from an engine results ``.rkf`` file.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="n">kf</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Properties&#39;</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>
            <span class="c1"># There are two *kinds* of &quot;Properties&quot; sections:</span>
            <span class="c1"># - ADF simply has a set of variables in the properties section</span>
            <span class="c1"># - DFTB and some other engines have a *scheme* for storing &quot;Properties&quot;. See the fortran &#39;RKFileModule&#39; (RKFile.f90)</span>
            <span class="c1">#   for more details on this.</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span> <span class="s1">&#39;nEntries&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">:</span>
                <span class="c1"># This is a &#39;RKFileModule&#39; properties section:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span> <span class="s1">&#39;nEntries&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">tp</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span> <span class="s1">&#39;Type(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">stp</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span> <span class="s1">&#39;Subtype(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span> <span class="s1">&#39;Value(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">stp</span> <span class="k">if</span> <span class="n">stp</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stp</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span> <span class="k">if</span> <span class="n">stp</span> <span class="k">else</span> <span class="n">tp</span><span class="p">)</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skeleton</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">get_skeleton</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">skeleton</span><span class="p">[</span><span class="s1">&#39;Properties&#39;</span><span class="p">]:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_energy"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_energy">[docs]</a>    <span class="k">def</span> <span class="nf">get_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return final energy, expressed in *unit*.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></div>
        <span class="c1"># try:</span>
        <span class="c1">#     return self._process_engine_results(lambda x: x.read(&#39;AMSResults&#39;, &#39;Energy&#39;), engine) * Units.conversion_ratio(&#39;au&#39;, unit)</span>
        <span class="c1"># except FileError as original_error:</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         return min(self.readrkf(&#39;PESScan&#39;, &#39;PES&#39;)) * Units.conversion_ratio(&#39;au&#39;, unit)</span>
        <span class="c1">#     except:</span>
        <span class="c1">#         raise original_error</span>


<div class="viewcode-block" id="AMSResults.get_gradients"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">get_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">dist_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the gradients of the final energy, expressed in *energy_unit* / *dist_unit*.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;Gradients&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">energy_unit</span><span class="p">)</span> <span class="o">/</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">dist_unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_stresstensor"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_stresstensor">[docs]</a>    <span class="k">def</span> <span class="nf">get_stresstensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the final stress tensor, expressed in atomic units.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;StressTensor&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_input_molecule</span><span class="p">()</span><span class="o">.</span><span class="n">lattice</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_hessian"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_hessian">[docs]</a>    <span class="k">def</span> <span class="nf">get_hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Hessian matrix, i.e. the second derivative of the total energy with respect to the nuclear coordinates, expressed in atomic units.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;Hessian&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_input_molecule</span><span class="p">()),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_elastictensor"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_elastictensor">[docs]</a>    <span class="k">def</span> <span class="nf">get_elastictensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the elastic tensor, expressed in atomic units.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">et_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;ElasticTensor&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span>
        <span class="n">num_latvec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_input_molecule</span><span class="p">()</span><span class="o">.</span><span class="n">lattice</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_latvec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">et_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_latvec</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">et_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">et_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_frequencies"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_frequencies">[docs]</a>    <span class="k">def</span> <span class="nf">get_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;cm^-1&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a numpy array of vibrational frequencies, expressed in *unit*.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;Vibrations&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequencies[cm-1]&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">freqs</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">freqs</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;cm^-1&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_charges"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_charges">[docs]</a>    <span class="k">def</span> <span class="nf">get_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the atomic charges, expressed in atomic units.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;Charges&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span></div>


<div class="viewcode-block" id="AMSResults.get_dipolemoment"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_dipolemoment">[docs]</a>    <span class="k">def</span> <span class="nf">get_dipolemoment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the electric dipole moment, expressed in atomic units.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;DipoleMoment&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span></div>


<div class="viewcode-block" id="AMSResults.get_dipolegradients"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_dipolegradients">[docs]</a>    <span class="k">def</span> <span class="nf">get_dipolegradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the nuclear gradients of the electric dipole moment, expressed in atomic units. This is a (3*numAtoms x 3) matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;DipoleGradients&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSResults.get_timings"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_timings">[docs]</a>    <span class="k">def</span> <span class="nf">get_timings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary with timing statistics of the job execution. Returned dictionary contains keys cpu, system and elapsed. The values are corresponding timings, expressed in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># new AMS versions store timings on ams.rkf</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;ElapsedTime&#39;</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;SysTime&#39;</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;cpu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;CPUTime&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># fall back to reading output, was needed for old AMS versions</span>
            <span class="n">cpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grep_output</span><span class="p">(</span><span class="s1">&#39;Total cpu time:&#39;</span><span class="p">)</span>
            <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grep_output</span><span class="p">(</span><span class="s1">&#39;Total system time:&#39;</span><span class="p">)</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grep_output</span><span class="p">(</span><span class="s1">&#39;Total elapsed time:&#39;</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elapsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">system</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;cpu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cpu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ret</span></div>


    <span class="k">def</span> <span class="nf">get_youngmodulus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;YoungModulus&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_shearmodulus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;ShearModulus&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_bulkmodulus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_engine_results</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;AMSResults&#39;</span><span class="p">,</span> <span class="s1">&#39;BulkModulus&#39;</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span> <span class="o">*</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

<div class="viewcode-block" id="AMSResults.get_pesscan_results"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_pesscan_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_pesscan_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecules</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            For PESScan jobs, this functions extracts information about the scan coordinates and energies.</span>

<span class="sd">            molecules : bool</span>
<span class="sd">                Whether to return a Molecule at each PES point.</span>

<span class="sd">            Returns a dictionary, with the following keys:</span>

<span class="sd">            &#39;RaveledScanCoords&#39;: a list of str with the names of the scan coordinates: [&#39;sc_1_1&#39;,&#39;sc_1_2&#39;,&#39;sc_2_1&#39;,&#39;sc_2_2&#39;,...]</span>

<span class="sd">            &#39;nRaveledScanCoords&#39;: the length of the previous list</span>

<span class="sd">            &#39;RaveledUnits&#39;: a list of str with the units: [&#39;bohr&#39;, &#39;bohr&#39;, &#39;radian&#39;, &#39;bohr&#39;, ...]</span>

<span class="sd">            &#39;RaveledPESCoords&#39;: a nested list with the values of the scan coordinates: [[val_1_1_1,val_1_1_2,...],[val_1_2_1,val_1_2_2,...],[val_2_1_1,val_2_1_2,...],[val_2_2_1,val_2_2_2]]</span>

<span class="sd">            &#39;ScanCoords&#39;: a nested list: [[&#39;sc_1_1&#39;,&#39;sc_1_2&#39;],[&#39;sc_2_1&#39;,&#39;sc_2_2&#39;],...]</span>

<span class="sd">            &#39;nScanCoords&#39;: length of the previous list</span>

<span class="sd">            &#39;Units&#39;: a nested list with the units: [[&#39;bohr&#39;, &#39;bohr&#39;],[&#39;radian&#39;, &#39;bohr&#39;], ...]</span>

<span class="sd">            &#39;OrigScanCoords&#39;: a list of str in the newline-separated format stored on the .rkf file: [&#39;sc_1_1\\nsc_1_2&#39;,&#39;sc_2_1\\nsc_2_2&#39;,...]</span>

<span class="sd">            &#39;nPESPoints&#39;: int, number of PES points</span>

<span class="sd">            &#39;PES&#39;: list of float, the energies at each PES point</span>

<span class="sd">            &#39;Converged&#39;: list of bool, whether the geometry optimization at each PES point converged</span>

<span class="sd">            &#39;Molecules&#39;: list of Molecule, the structure at each PES point. Only if the property molecules == True</span>

<span class="sd">            &#39;HistoryIndices&#39;: list of int, the indices (1-based) in the History section which correspond to the Molecules and PES.</span>

<span class="sd">            &#39;Properties&#39;: list of dict. The dictionary keys are what can be found on the AMSResults section of the engine .rkf file. These will only be populated if &quot;CalcPropertiesAtPESPoints&quot; is set to Yes when running the PES scan.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">tolist</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>

        <span class="n">nScanCoord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;PESScan&#39;</span><span class="p">,</span> <span class="s1">&#39;nScanCoord&#39;</span><span class="p">)</span>
        <span class="n">nPoints</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_history_property</span><span class="p">(</span><span class="s1">&#39;nPoints&#39;</span><span class="p">,</span> <span class="s1">&#39;PESScan&#39;</span><span class="p">))</span>

        <span class="n">pes</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;PESScan&#39;</span><span class="p">,</span> <span class="s1">&#39;PES&#39;</span><span class="p">))</span>

        <span class="n">origscancoords</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_history_property</span><span class="p">(</span><span class="s1">&#39;ScanCoord&#39;</span><span class="p">,</span> <span class="n">history_section</span><span class="o">=</span><span class="s1">&#39;PESScan&#39;</span><span class="p">))</span>
        <span class="c1"># one scan coordinate may have several variables</span>
        <span class="n">scancoords</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">origscancoords</span><span class="p">]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pescoords</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;PESScan&#39;</span><span class="p">,</span> <span class="s1">&#39;PESCoords&#39;</span><span class="p">))</span>
        <span class="n">pescoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pescoords</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scancoords</span><span class="p">))</span>
        <span class="n">pescoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">pescoords</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nScanCoord</span><span class="p">):</span>
            <span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scancoords</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">scancoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;Dist&#39;</span> <span class="ow">in</span> <span class="n">scancoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bohr&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;Volume&#39;</span> <span class="ow">in</span> <span class="n">scancoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bohr^3&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;Area&#39;</span> <span class="ow">in</span> <span class="n">scancoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bohr^2&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;radian&#39;</span><span class="p">)</span>

        <span class="n">converged</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;PESScan&#39;</span><span class="p">,</span> <span class="s1">&#39;GOConverged&#39;</span><span class="p">))</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">converged</span><span class="p">]</span>
        <span class="n">historyindices</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;PESScan&#39;</span><span class="p">,</span> <span class="s1">&#39;HistoryIndices&#39;</span><span class="p">))</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">raveled_scancoords</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scancoords</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span> <span class="c1"># 1d list</span>
        <span class="n">raveled_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">units</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span> <span class="c1"># 1d list</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;RaveledScanCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raveled_scancoords</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;nRaveledScanCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raveled_scancoords</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;ScanCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scancoords</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;nScanCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scancoords</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;OrigScanCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origscancoords</span> <span class="c1">#newline delimiter for joint scan coordinates</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;RaveledPESCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pescoords</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;RaveledUnits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raveled_units</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Converged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">converged</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;PES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pes</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;nPESPoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pes</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;HistoryIndices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">historyindices</span>

        <span class="k">if</span> <span class="n">molecules</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">historyindices</span><span class="p">:</span>
                <span class="n">mols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_history_molecule</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Molecules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mols</span>

        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># self.rkfs has the keys PESPoint(1), PESPoint(2), ..., ams</span>
        <span class="c1"># need to loop here to guarantee right order</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;PESPoint(</span><span class="si">{i}</span><span class="s2">)&quot;</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span>
                <span class="n">amsresults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">read_section</span><span class="p">(</span><span class="s2">&quot;AMSResults&quot;</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amsresults</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Properties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">amsresults</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="AMSResults.get_neb_results"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_neb_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_neb_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecules</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary with results from a NEB calculation.</span>

<span class="sd">        molecules : bool</span>
<span class="sd">            Whether to include the &#39;Molecules&#39; key in the return result</span>

<span class="sd">        unit : str</span>
<span class="sd">            Energy unit for the Energies, LeftBarrier, RightBarrier, and ReactionEnergy</span>

<span class="sd">        Returns: dict</span>
<span class="sd">            &#39;nImages&#39;: number of images (excluding end points)</span>

<span class="sd">            &#39;nIterations&#39;: number of iterations</span>

<span class="sd">            &#39;Energies&#39;: list of energies (including end points)</span>

<span class="sd">            &#39;Climbing&#39;: bool, whether climbing image NEB was used</span>

<span class="sd">            &#39;LeftBarrier&#39;: float, left reaction barrier</span>

<span class="sd">            &#39;RightBarrier&#39;: float, right reaction barrier</span>

<span class="sd">            &#39;ReactionEnergy&#39;: float, reaction energy</span>

<span class="sd">            &#39;HistoryIndices&#39;: list of int, same length as &#39;Energies&#39;, contains indices in the History section</span>

<span class="sd">            &#39;Molecules&#39;: list of Molecule (including end points)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">tolist</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">conversion_ratio</span> <span class="o">=</span> <span class="n">Units</span><span class="o">.</span><span class="n">conversion_ratio</span><span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;nImages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;nebImages&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;nIterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;nebIterations&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Climbing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;climbing&#39;</span><span class="p">))</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;HighestIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;highestIndex&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;LeftBarrier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;LeftBarrier&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">conversion_ratio</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;RightBarrier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;RightBarrier&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">conversion_ratio</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;ReactionEnergy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;ReactionEnergy&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">conversion_ratio</span>
        <span class="n">history_dim</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;historyIndex@dim&#39;</span><span class="p">))</span> <span class="c1"># nimages, randombign</span>
        <span class="n">history_dim</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1"># randombign, nimages</span>
        <span class="n">history_indices_matrix</span> <span class="o">=</span> <span class="n">tolist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;NEB&#39;</span><span class="p">,</span> <span class="s1">&#39;historyIndex&#39;</span><span class="p">))</span>  <span class="c1"># this matrix is padded with -1 values</span>
        <span class="n">history_indices_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">history_indices_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">history_dim</span><span class="p">)</span>
        <span class="n">history_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">history_indices_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">history_indices</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found -1 in the &#39;converged&#39; part of historyIndex. This should not happen!&quot;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;HistoryIndices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">history_indices</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Energies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_property_at_step</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">conversion_ratio</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;HistoryIndices&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">molecules</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Molecules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_history_molecule</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;HistoryIndices&#39;</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">ret</span></div>





<div class="viewcode-block" id="AMSResults.recreate_molecule"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.recreate_molecule">[docs]</a>    <span class="k">def</span> <span class="nf">recreate_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recreate the input molecule for the corresponding job based on files present in the job folder. This method is used by |load_external|.</span>

<span class="sd">        If ``ams.rkf`` is present in the job folder, extract data from the ``InputMolecule`` section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_input_molecule</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="AMSResults.recreate_settings"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.recreate_settings">[docs]</a>    <span class="k">def</span> <span class="nf">recreate_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recreate the input |Settings| instance for the corresponding job based on files present in the job folder. This method is used by |load_external|.</span>

<span class="sd">        If ``ams.rkf`` is present in the job folder, extract user input and parse it back to a |Settings| instance using ``scm.input_parser`` module. Remove the ``system`` branch from that instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;user input&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">scm.input_parser</span> <span class="k">import</span> <span class="n">InputParser</span>
                <span class="k">with</span> <span class="n">InputParser</span><span class="p">()</span> <span class="k">as</span> <span class="n">parser</span><span class="p">:</span>
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">to_settings</span><span class="p">(</span><span class="s1">&#39;ams&#39;</span><span class="p">,</span> <span class="n">user_input</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="s1">&#39;Failed to recreate input settings from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="s1">&#39;ams&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
            <span class="n">s</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">inp</span>
            <span class="k">if</span> <span class="s1">&#39;system&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">ams</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">s</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">ams</span><span class="o">.</span><span class="n">system</span>
            <span class="n">s</span><span class="o">.</span><span class="n">soft_update</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">job</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="AMSResults.ok"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.ok">[docs]</a>    <span class="k">def</span> <span class="nf">ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the execution of the associated :attr:`job` was successful or not.</span>
<span class="sd">        See :meth:`Job.ok&lt;scm.plams.core.basejob.Job.ok&gt;` for more information.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">ok</span><span class="p">()</span></div>


<div class="viewcode-block" id="AMSResults.get_errormsg"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_errormsg">[docs]</a>    <span class="k">def</span> <span class="nf">get_errormsg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tries to get an an error message for a associated :attr:`job`. This method returns ``None`` if the associated job was successful.</span>
<span class="sd">        See :meth:`Job.get_errormsg&lt;scm.plams.core.basejob.Job.errormsg&gt;` for more information.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">get_errormsg</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrun the :attr:`job.name` of the job associated with this results instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">name</span>


    <span class="k">class</span> <span class="nc">EnergyLandscape</span><span class="p">:</span>

        <span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">landscape</span><span class="p">,</span> <span class="n">engfile</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">isTS</span><span class="p">,</span> <span class="n">reactantsID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">productsID</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="o">=</span> <span class="n">landscape</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engfile</span> <span class="o">=</span> <span class="n">engfile</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mol</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isTS</span> <span class="o">=</span> <span class="n">isTS</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reactantsID</span> <span class="o">=</span> <span class="n">reactantsID</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">productsID</span> <span class="o">=</span> <span class="n">productsID</span>

            <span class="nd">@property</span>
            <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span><span class="o">.</span><span class="n">_states</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

            <span class="nd">@property</span>
            <span class="k">def</span> <span class="nf">reactants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reactantsID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="nd">@property</span>
            <span class="k">def</span> <span class="nf">products</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">productsID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isTS</span><span class="p">:</span>
                    <span class="n">lines</span>  <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;State </span><span class="si">{self.id}</span><span class="s2">: transition state @ </span><span class="si">{self.energy}</span><span class="s2"> Hartree (found </span><span class="si">{self.count}</span><span class="s2"> times, results on </span><span class="si">{self.engfile}</span><span class="s2">)&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactantsID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;|- Reactants: </span><span class="si">{self.reactants}</span><span class="s2">&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">productsID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;+- Products:  </span><span class="si">{self.products}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span>  <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;State </span><span class="si">{self.id}</span><span class="s2">: local minimum @ </span><span class="si">{self.energy}</span><span class="s2"> Hartree (found </span><span class="si">{self.count}</span><span class="s2"> times, results on </span><span class="si">{self.engfile}</span><span class="s2">)&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
            <span class="n">sec</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">read_rkf_section</span><span class="p">(</span><span class="s2">&quot;EnergyLandscape&quot;</span><span class="p">)</span>

            <span class="c1"># If there is only 1 state in the &#39;EnergyLandscape&#39; section, some variables that are normally lists are insted be build-in types (e.g. a &#39;float&#39; instead of a &#39;list of floats&#39;).</span>
            <span class="c1"># For convenience here we make sure that the following variables are always &#39;lists&#39;:</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;energies&#39;</span><span class="p">,</span> <span class="s1">&#39;counts&#39;</span><span class="p">,</span> <span class="s1">&#39;isTS&#39;</span><span class="p">,</span> <span class="s1">&#39;reactants&#39;</span><span class="p">,</span> <span class="s1">&#39;products&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sec</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">sec</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sec</span><span class="p">[</span><span class="n">var</span><span class="p">]]</span>

            <span class="n">nStates</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;nStates&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_states</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">iState</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nStates</span><span class="p">):</span>
                <span class="n">energy</span>  <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;energies&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]</span>
                <span class="n">resfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sec</span><span class="p">[</span><span class="s1">&#39;fileNames&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)[</span><span class="n">iState</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="s1">&#39;Molecule&#39;</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="n">resfile</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;isTS&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AMSResults</span><span class="o">.</span><span class="n">EnergyLandscape</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resfile</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reactantsID</span> <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;reactants&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]</span> <span class="k">if</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;reactants&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">productsID</span>  <span class="o">=</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]</span> <span class="k">if</span> <span class="n">sec</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="n">iState</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AMSResults</span><span class="o">.</span><span class="n">EnergyLandscape</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resfile</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">reactantsID</span><span class="p">,</span> <span class="n">productsID</span><span class="p">))</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">minima</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">isTS</span> <span class="p">]</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">transition_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isTS</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;All stationary points:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
                   <span class="s1">&#39;======================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
                   <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_states</span><span class="p">)</span>


<div class="viewcode-block" id="AMSResults.get_energy_landscape"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSResults.get_energy_landscape">[docs]</a>    <span class="k">def</span> <span class="nf">get_energy_landscape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the energy landscape obtained from a PESExploration job run by the AMS driver. The energy landscape is a set of stationary PES points (local minima and transition states).</span>

<span class="sd">        The returned object is of the type ``AMSResults.EnergyLandscape`` and offers convenient access to the states&#39; energies, geometries as well as the information on which transition states connect which minima.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            el = results.get_energy_landscape()</span>
<span class="sd">            print(el)</span>

<span class="sd">            for state in el:</span>
<span class="sd">                print(f&quot;Energy = {state.energy}&quot;)</span>
<span class="sd">                print(f&quot;Is transition state = {state.isTS}&quot;)</span>
<span class="sd">                print(&quot;Geometry:&quot;, state.molecule)</span>
<span class="sd">                if state.isTS:</span>
<span class="sd">                    print(f&quot;Forward  barrier: {state.energy - state.reactants.energy}&quot;)</span>
<span class="sd">                    print(f&quot;Backward barrier: {state.energy - state.products.energy}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AMSResults</span><span class="o">.</span><span class="n">EnergyLandscape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="c1">#=========================================================================</span>


    <span class="k">def</span> <span class="nf">_access_rkf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A skeleton method for accessing any of the ``.rkf`` files produced by AMS.</span>

<span class="sd">        The *file* argument should be the identifier of the file to read. It defaults to ``&#39;ams&#39;``. To access a file called ``something.rkf`` you need to call this function with ``file=&#39;something&#39;``. If there exists only one engine results ``.rkf`` file, you can call this function with ``file=&#39;engine&#39;`` to access this file.</span>

<span class="sd">        The *func* argument has to be a function to call on a chosen ``.rkf`` file. It should take one argument, an instance of |KFFile|.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Try unique engine:</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s1">&#39;engine&#39;</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine_names</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot use &#39;engine&#39; as &#39;file&#39; argument if the engine results file is not unique. Please use the real name of the file you wish to read&quot;</span><span class="p">)</span>

        <span class="c1">#Try:</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>

        <span class="c1">#Try harder:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;.rkf&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFFile</span><span class="p">(</span><span class="n">opj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">file</span><span class="p">])</span>

        <span class="c1">#Surrender:</span>
        <span class="k">raise</span> <span class="n">FileError</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">{}</span><span class="s1"> not present in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">_process_engine_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A generic method skeleton for processing any engine results ``.rkf`` file. *func* should be a function that takes one argument (an instance of |KFFile|) and returns arbitrary data.</span>

<span class="sd">        The *engine* argument should be the identifier of the file you wish to read. To access a file called ``something.rkf`` you need to call this function with ``engine=&#39;something&#39;``. The *engine* argument can be omitted if there&#39;s only one engine results file in the job folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">engine</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">engine</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileError</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">{}</span><span class="s1">.rkf not present in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rkfs</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileError</span><span class="p">(</span><span class="s1">&#39;There is no engine .rkf present in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You need to specify the &#39;engine&#39; argument when there are multiple engine result files present in the job folder&quot;</span><span class="p">)</span></div>


<span class="c1">#===========================================================================</span>
<span class="c1">#===========================================================================</span>
<span class="c1">#===========================================================================</span>


<div class="viewcode-block" id="AMSJob"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob">[docs]</a><span class="k">class</span> <span class="nc">AMSJob</span><span class="p">(</span><span class="n">SingleJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class representing a single computation with AMS driver. The corresponding results type is |AMSResults|.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_result_type</span> <span class="o">=</span> <span class="n">AMSResults</span>
    <span class="n">_command</span> <span class="o">=</span> <span class="s1">&#39;ams&#39;</span>


<div class="viewcode-block" id="AMSJob.from_input"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.from_input">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_input</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">text_input</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;plamsjob&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an AMSJob from AMS-style text input. This function requires that the SCM Python package is installed (if not, it will raise an ImportError). </span>

<span class="sd">        text_input : a multi-line string</span>

<span class="sd">        Returns: An AMSJob instance</span>

<span class="sd">        Note: The ``name`` and ``molecule`` of the returned AMSJob will not be set. If there is a System block in the ``text_input``, then it will be read into the returned job&#39;s settings.</span>

<span class="sd">        Example::</span>

<span class="sd">           text = &#39;&#39;&#39;</span>
<span class="sd">           Task GeometryOptimization</span>
<span class="sd">           Engine DFTB</span>
<span class="sd">               Model GFN1-xTB</span>
<span class="sd">           EndEngine</span>
<span class="sd">           &#39;&#39;&#39;</span>

<span class="sd">           job = AMSJob.from_input(text)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scm.input_parser</span> <span class="k">import</span> <span class="n">InputParser</span>
        <span class="n">sett</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">InputParser</span><span class="p">()</span> <span class="k">as</span> <span class="n">parser</span><span class="p">:</span>
            <span class="n">sett</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">to_settings</span><span class="p">(</span><span class="s1">&#39;ams&#39;</span><span class="p">,</span> <span class="n">text_input</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">sett</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">molecule</span><span class="p">)</span></div>

<div class="viewcode-block" id="AMSJob.from_runfile"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.from_runfile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_runfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;plamsjob&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        path : path to an AMS .run or .in file. Note: for AMS jobs generated with PLAMS, you should pass the path to the .in file to this function.</span>

<span class="sd">        Returns an AMSJob based on the text input in the .run or .in file.</span>

<span class="sd">        Note: The ``name`` and ``molecule`` of the returned AMSJob will not be set. If there is a System block in the run file, then it will be read into the returned job&#39;s settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">run</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;&lt;&#39;</span> <span class="ow">in</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&lt;&lt;.*?(\w+)&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">run</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rf</span><span class="s2">&quot;(?s)(?:</span><span class="si">{delimiter}</span><span class="s2">)(.*)(?:[</span><span class="se">\r\n</span><span class="s2">]</span><span class="si">{delimiter}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_input</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">molecule</span><span class="p">)</span></div>

<div class="viewcode-block" id="AMSJob.run"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobrunner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">jobmanager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the job using *jobmanager* and *jobrunner* (or defaults, if ``None``).</span>

<span class="sd">        If *watch* is set to ``True``, the contents of the AMS driver logfile will be forwarded line by line to the PLAMS logfile (and stdout), allowing for an easier monitoring of the running job. Not that the forwarding of the AMS driver logfile will cause make the call to this method block until the job&#39;s execution has finished, even when using a parallel |JobRunner|.</span>

<span class="sd">        Other keyword arguments (*\*\*kwargs*) are stored in ``run`` branch of job&#39;s settings.</span>

<span class="sd">        Returned value is the |AMSResults| instance associated with this job.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">_has_watchdog</span> <span class="ow">and</span> <span class="n">watch</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;default_jobmanager&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">jobmanager</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_jobmanager</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PlamsError</span><span class="p">(</span><span class="s1">&#39;No default jobmanager found. This probably means that PLAMS init() was not called.&#39;</span><span class="p">)</span>

            <span class="n">observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">()</span>
            <span class="n">event_handler</span> <span class="o">=</span> <span class="n">AMSJobLogTailHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobmanager</span><span class="p">)</span>
            <span class="n">observer</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">event_handler</span><span class="p">,</span> <span class="n">jobmanager</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">observer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jobrunner</span><span class="o">=</span><span class="n">jobrunner</span><span class="p">,</span> <span class="n">jobmanager</span><span class="o">=</span><span class="n">jobmanager</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">observer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">observer</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jobrunner</span><span class="o">=</span><span class="n">jobrunner</span><span class="p">,</span> <span class="n">jobmanager</span><span class="o">=</span><span class="n">jobmanager</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="AMSJob.get_input"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.get_input">[docs]</a>    <span class="k">def</span> <span class="nf">get_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the input file. This method is just a wrapper around :meth:`_serialize_input`.</span>

<span class="sd">        Each instance of |AMSJob| or |AMSResults| present as a value in ``settings.input`` branch is replaced with an absolute path to ``ams.rkf`` file of that job.</span>

<span class="sd">        If you need to use a path to some engine specific ``.rkf`` file rather than the main ``ams.rkf`` file, you can to it by supplying a tuple ``(x, name)`` where ``x`` is an instance of |AMSJob| or |AMSResults| and ``name`` is a string with the name of the ``.rkf`` file you want. For example, ``(myjob, &#39;dftb&#39;)`` will transform to the absolute path to ``dftb.rkf`` file in ``myjob``&#39;s folder, if such a file is present.</span>

<span class="sd">        Instances of |KFFile| are replaced with absolute paths to corresponding files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">special</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">AMSJob</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">rkfpath</span><span class="p">(),</span>
            <span class="n">AMSResults</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rkfpath</span><span class="p">(),</span>
            <span class="n">KFFile</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">AMSJob</span><span class="o">.</span><span class="n">_tuple2rkf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_input</span><span class="p">(</span><span class="n">special</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSJob.get_runscript"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.get_runscript">[docs]</a>    <span class="k">def</span> <span class="nf">get_runscript</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the runscript. Returned string is of the form::</span>

<span class="sd">            unset AMS_SWITCH_LOGFILE_AND_STDOUT</span>
<span class="sd">            AMS_JOBNAME=jobname AMS_RESULTSDIR=. $AMSBIN/ams [-n nproc] &lt;jobname.in [&gt;jobname.out]</span>

<span class="sd">        ``-n`` flag is added if ``settings.runscript.nproc`` exists. ``[&gt;jobname.out]`` is used based on ``settings.runscript.stdout_redirect``. If ``settings.runscript.preamble_lines`` exists, those lines will be added to the runscript verbatim before the execution of AMS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span>  <span class="o">=</span> <span class="s1">&#39;unset AMS_SWITCH_LOGFILE_AND_STDOUT</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;unset SCM_LOGFILE</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;preamble_lines&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">runscript</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">runscript</span><span class="o">.</span><span class="n">preamble_lines</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{line}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;AMS_JOBNAME=&quot;</span><span class="si">{}</span><span class="s1">&quot; AMS_RESULTSDIR=. $AMSBIN/ams&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;nproc&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">runscript</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; -n </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">runscript</span><span class="o">.</span><span class="n">nproc</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &lt;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">(</span><span class="s1">&#39;inp&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">runscript</span><span class="o">.</span><span class="n">stdout_redirect</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &gt;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">))</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">AMSJob</span><span class="o">.</span><span class="n">_slurm_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span> <span class="o">+</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="AMSJob.check"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if ``termination status`` variable from ``General`` section of main KF file equals ``NORMAL TERMINATION``.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;termination status&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;NORMAL TERMINATION&#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;errors&#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="s1">&#39;Job </span><span class="si">{}</span><span class="s1"> reported errors. Please check the the output&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s1">&#39;warnings&#39;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="s1">&#39;Job </span><span class="si">{}</span><span class="s1"> reported warnings. Please check the the output&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="AMSJob.get_errormsg"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.get_errormsg">[docs]</a>    <span class="k">def</span> <span class="nf">get_errormsg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tries to get an error message for a failed job. This method returns ``None`` for successful jobs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Something went wrong. The first place to check is the termination status on the ams.rkf.</span>
            <span class="c1"># If the AMS driver stopped with a known error (called StopIt in the Fortran code), the error will be in there.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">readrkf</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="s1">&#39;termination status&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s1">&#39;NORMAL TERMINATION with errors&#39;</span> <span class="ow">or</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Apparently this wasn&#39;t a hard stop in the middle of the job.</span>
                    <span class="c1"># Let&#39;s look for the last error in the logfile ...</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">grep_file</span><span class="p">(</span><span class="s1">&#39;ams.log&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR: &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">msg</span> <span class="o">==</span> <span class="s1">&#39;IN PROGRESS&#39;</span> <span class="ow">and</span> <span class="s1">&#39;$JN.err&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                    <span class="c1"># If the status is still &quot;IN PROGRESS&quot;, that probably means AMS was shut down hard from the outside.</span>
                    <span class="c1"># E.g. it got SIGKILL from the scheduler for exceeding some resource limit.</span>
                    <span class="c1"># In this case useful information may be found on stderr.</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;$JN.err&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="n">errlines</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">errlines</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Killed while IN PROGRESS: &quot;</span> <span class="o">+</span> <span class="n">el</span>
                            <span class="k">break</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Could not determine error message. Please check the output manually.&#39;</span>
            <span class="k">return</span> <span class="n">msg</span></div>



<div class="viewcode-block" id="AMSJob.hash_input"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.hash_input">[docs]</a>    <span class="k">def</span> <span class="nf">hash_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the hash of the input file.</span>

<span class="sd">        All instances of |AMSJob| or |AMSResults| present as values in ``settings.input`` branch are replaced with hashes of corresponding job&#39;s inputs. Instances of |KFFile| are replaced with absolute paths to corresponding files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">special</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">AMSJob</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">hash_input</span><span class="p">(),</span>
            <span class="n">AMSResults</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">hash_input</span><span class="p">(),</span>
            <span class="n">KFFile</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">AMSJob</span><span class="o">.</span><span class="n">_tuple2rkf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">sha256</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serialize_input</span><span class="p">(</span><span class="n">special</span><span class="p">))</span></div>


    <span class="c1">#=========================================================================</span>


    <span class="k">def</span> <span class="nf">_serialize_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">special</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform the contents of ``settings.input`` branch into string with blocks, keys and values.</span>

<span class="sd">        First, the contents of ``settings.input`` are extended with entries returned by :meth:`_serialize_molecule`. Then the contents of ``settings.input.ams`` are used to generate AMS text input. Finally, every other (than ``ams``) entry in ``settings.input`` is used to generate engine specific input.</span>

<span class="sd">        Special values can be indicated with *special* argument, which should be a dictionary having types of objects as keys and functions translating these types to strings as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">unspec</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Check if *value* is one of a special types and convert it to string if it is.&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">spec_type</span> <span class="ow">in</span> <span class="n">special</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">spec_type</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">special</span><span class="p">[</span><span class="n">spec_type</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;End&#39;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Given a *key* and its corresponding *value* from the |Settings| instance produce a snippet of the input file representing this pair.</span>

<span class="sd">            If the value is a nested |Settings| instance, use recursive calls to build the snippet for the entire block. Indent the result with *indent* spaces.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Settings</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">key</span>
                <span class="k">if</span> <span class="s1">&#39;_h&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">unspec</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;_h&#39;</span><span class="p">])</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;engine&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">el</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">:</span>
                            <span class="n">ret</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">el</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;EndInput&#39;</span><span class="p">)</span>
                        <span class="c1"># REB: For the hybrid engine. How todeal with the space in el (Engine DFTB)? Replace by underscore?</span>
                        <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;engine&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">el</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;engine&#39;</span><span class="p">)</span> <span class="p">:</span>
                            <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
                            <span class="n">ret</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">el</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;EndEngine&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ret</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">el</span><span class="p">],</span> <span class="n">indent</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;endinput&#39;</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">end</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">unspec</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="n">fullinput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1">#prepare contents of &#39;system&#39; block(s)</span>
        <span class="n">more_systems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_molecule</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">more_systems</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;system&#39;</span> <span class="ow">in</span> <span class="n">fullinput</span><span class="o">.</span><span class="n">ams</span><span class="p">:</span>
                <span class="c1">#nonempty system block was already present in input.ams</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">fullinput</span><span class="o">.</span><span class="n">ams</span><span class="o">.</span><span class="n">system</span>
                <span class="n">system_list</span> <span class="o">=</span> <span class="n">system</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">system</span><span class="p">]</span>

                <span class="n">system_list_set</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">({(</span><span class="n">s</span><span class="o">.</span><span class="n">_h</span> <span class="k">if</span> <span class="s1">&#39;_h&#39;</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">):</span><span class="n">s</span>   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">system_list</span><span class="p">})</span>
                <span class="n">more_systems_set</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">({(</span><span class="n">s</span><span class="o">.</span><span class="n">_h</span> <span class="k">if</span> <span class="s1">&#39;_h&#39;</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">):</span><span class="n">s</span>   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">more_systems</span><span class="p">})</span>

                <span class="n">system_list_set</span> <span class="o">+=</span> <span class="n">more_systems_set</span>
                <span class="n">system_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">system_list_set</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">system_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">system_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">system_list</span>
                <span class="n">fullinput</span><span class="o">.</span><span class="n">ams</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">fullinput</span><span class="o">.</span><span class="n">ams</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">more_systems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">more_systems</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">more_systems</span>

        <span class="n">txtinp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ams</span> <span class="o">=</span> <span class="n">fullinput</span><span class="o">.</span><span class="n">find_case</span><span class="p">(</span><span class="s1">&#39;ams&#39;</span><span class="p">)</span>

        <span class="c1">#contents of the &#39;ams&#39; block (AMS input) go first</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fullinput</span><span class="p">[</span><span class="n">ams</span><span class="p">]:</span>
            <span class="n">txtinp</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">fullinput</span><span class="p">[</span><span class="n">ams</span><span class="p">][</span><span class="n">item</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="c1">#and then engines</span>
        <span class="k">for</span> <span class="n">engine</span> <span class="ow">in</span> <span class="n">fullinput</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">engine</span> <span class="o">!=</span> <span class="n">ams</span><span class="p">:</span>
                <span class="n">txtinp</span> <span class="o">+=</span> <span class="n">serialize</span><span class="p">(</span><span class="s1">&#39;Engine &#39;</span><span class="o">+</span><span class="n">engine</span><span class="p">,</span> <span class="n">fullinput</span><span class="p">[</span><span class="n">engine</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;EndEngine&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">txtinp</span>


    <span class="k">def</span> <span class="nf">_serialize_molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of |Settings| instances containing the information about one or more |Molecule| instances stored in the ``molecule`` attribute.</span>

<span class="sd">        Molecular charge is taken from ``molecule.properties.charge``, if present. Additional, atom-specific information to be put in ``atoms`` block after XYZ coordinates can be supplied with ``atom.properties.suffix``.</span>

<span class="sd">        If the ``molecule`` attribute is a dictionary, the returned list is of the same length as the size of the dictionary. Keys from the dictionary are used as headers of returned ``system`` blocks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Settings</span><span class="p">()</span>

        <span class="n">moldict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="n">moldict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">moldict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JobError</span><span class="p">(</span><span class="s2">&quot;Incorrect &#39;molecule&#39; attribute of job </span><span class="si">{}</span><span class="s2">. &#39;molecule&#39; should be a Molecule, a dictionary or None, and not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span><span class="p">(),</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="p">)))</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">moldict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">newsystem</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">newsystem</span><span class="o">.</span><span class="n">_h</span> <span class="o">=</span> <span class="n">name</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">lattice</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">molecule</span><span class="o">.</span><span class="n">align_lattice</span><span class="p">():</span>
                <span class="n">log</span><span class="p">(</span><span class="s2">&quot;The lattice of </span><span class="si">{}</span><span class="s2"> Molecule supplied for job </span><span class="si">{}</span><span class="s2"> did not follow the convention required by AMS. I rotated the whole system for you. You&#39;re welcome&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">newsystem</span><span class="o">.</span><span class="n">Atoms</span><span class="o">.</span><span class="n">_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">),</span> <span class="n">space</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">suffix</span><span class="o">=</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">suffix</span> <span class="k">if</span> <span class="s1">&#39;suffix&#39;</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">properties</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">molecule</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">molecule</span><span class="o">.</span><span class="n">lattice</span><span class="p">:</span>
                <span class="n">newsystem</span><span class="o">.</span><span class="n">Lattice</span><span class="o">.</span><span class="n">_1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{:16.10f}</span><span class="s1"> </span><span class="si">{:16.10f}</span><span class="s1"> </span><span class="si">{:16.10f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">vec</span><span class="p">)</span> <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">lattice</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">atom1</span><span class="p">),</span> <span class="n">molecule</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">atom2</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">order</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">bonds</span><span class="p">]</span>
                <span class="c1"># Add bond properties if they are defined</span>
                <span class="n">newsystem</span><span class="o">.</span><span class="n">BondOrders</span><span class="o">.</span><span class="n">_1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">molecule</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;suffix&#39;</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span> <span class="k">else</span> <span class="n">text</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)]</span>

            <span class="k">if</span> <span class="s1">&#39;charge&#39;</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
                <span class="n">newsystem</span><span class="o">.</span><span class="n">Charge</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">charge</span>

            <span class="k">if</span> <span class="s1">&#39;regions&#39;</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">properties</span> <span class="p">:</span>
                <span class="c1">#newsystem.Region = [Settings({&#39;_h&#39;:name, &#39;_1&#39;:[&#39;%s=%s&#39;%(k,str(v)) for k,v in data.items()]}) for name, data in molecule.properties.regions.items()]</span>
                <span class="n">newsystem</span><span class="o">.</span><span class="n">Region</span> <span class="o">=</span> <span class="p">[</span><span class="n">Settings</span><span class="p">({</span><span class="s1">&#39;_h&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Properties&#39;</span><span class="p">:</span><span class="n">Settings</span><span class="p">({</span><span class="s1">&#39;_1&#39;</span><span class="p">:[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]})})</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">list</span><span class="p">)]</span>

            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newsystem</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>


    <span class="c1">#=========================================================================</span>

<div class="viewcode-block" id="AMSJob.get_task"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.get_task">[docs]</a>    <span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the AMS Task from the job&#39;s settings. If it does not exist, returns None. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">Settings</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;input&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="ow">and</span> <span class="s1">&#39;ams&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">input</span> <span class="ow">and</span> <span class="s1">&#39;task&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">ams</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">ams</span><span class="o">.</span><span class="n">task</span>
        <span class="k">return</span> <span class="kc">None</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_atom_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the atomic symbol of *atom*. Ensure proper formatting for AMSuite input taking into account ``ghost`` and ``name`` entries in ``properties`` of *atom*.&quot;&quot;&quot;</span>
        <span class="n">smb</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">atnum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>  <span class="c1">#Dummy atom should have &#39;&#39; instead of &#39;Xx&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;ghost&#39;</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">properties</span> <span class="ow">and</span> <span class="n">atom</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">ghost</span><span class="p">:</span>
            <span class="n">smb</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Gh.&#39;</span><span class="o">+</span><span class="n">smb</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="n">smb</span> <span class="o">=</span> <span class="p">(</span><span class="n">smb</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">smb</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_tuple2rkf</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform a pair ``(x, name)`` where ``x`` is an instance of |AMSJob| or |AMSResults| and ``name`` is a name of ``.rkf`` file (``ams`` or engine) to an absolute path to that ``.rkf`` file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">AMSJob</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">rkfpath</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">AMSResults</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rkfpath</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>


<div class="viewcode-block" id="AMSJob.load_external"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.load_external">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_external</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ams&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load an external job from *path*.</span>

<span class="sd">        In this context an &quot;external job&quot; is an execution of some external binary that was not managed by PLAMS, and hence does not have a ``.dill`` file. It can also be used in situations where the execution was started with PLAMS, but the Python process was terminated before the execution finished, resulting in steps 9-12 of :ref:`job-life-cycle` not happening.</span>

<span class="sd">        All the files produced by your computation should be placed in one folder and *path* should be the path to this folder or a file in this folder. The name of the folder is used as a job name. Input, output, error and runscript files, if present, should have names defined in ``_filenames`` class attribute (usually ``[jobname].in``, ``[jobname].out``, ``[jobname].err`` and ``[jobname].run``). It is not required to supply all these files, but in most cases one would like to use at least the output file, in order to use methods like :meth:`~scm.plams.core.results.Results.grep_output` or :meth:`~scm.plams.core.results.Results.get_output_chunk`. If *path* is an instance of an AMSJob, that instance is returned.</span>

<span class="sd">        This method is a class method, so it is called via class object and it returns an instance of that class::</span>

<span class="sd">            &gt;&gt;&gt; a = AMSJob.load_external(path=&#39;some/path/jobname&#39;)</span>
<span class="sd">            &gt;&gt;&gt; type(a)</span>
<span class="sd">            scm.plams.interfaces.adfsuite.ams.AMSJob</span>

<span class="sd">        You can supply |Settings| and |Molecule| instances as *settings* and *molecule* parameters, they will end up attached to the returned job instance. If you don&#39;t do this, PLAMS will try to recreate them automatically using methods :meth:`~scm.plams.core.results.Results.recreate_settings` and :meth:`~scm.plams.core.results.Results.recreate_molecule` of the corresponding |Results| subclass. If no |Settings| instance is obtained in either way, the defaults from ``config.job`` are copied.</span>

<span class="sd">        You can set the *finalize* parameter to ``True`` if you wish to run the whole :meth:`~Job._finalize` on the newly created job. In that case PLAMS will perform the usual :meth:`~Job.check` to determine the job status (*successful* or *failed*), followed by cleaning of the job folder (|cleaning|), |postrun| and pickling (|pickling|). If *finalize* is ``False``, the status of the returned job is *copied*.</span>

<span class="sd">        fmt : str</span>
<span class="sd">            One of &#39;ams&#39;, &#39;qe&#39;, &#39;vasp&#39;, or &#39;any&#39;.</span>

<span class="sd">            &#39;ams&#39;: load a finished AMS job</span>

<span class="sd">            &#39;qe&#39;: convert a Quantum ESPRESSO .out file to ams.rkf and qe.rkf and load from those files</span>

<span class="sd">            &#39;vasp&#39;: convert a VASP OUTCAR file to ams.rkf and vasp.rkf and load from those files (see more below)</span>

<span class="sd">            &#39;any&#39;: auto-detect the format.</span>

<span class="sd">        This method can also be used to convert a finished VASP job to an AMSJob. If you supply the path to a folder containing OUTCAR, then a subdirectory will be created in this folder called AMSJob. In the AMSJob subdirectory, two files will be created: ams.rkf and vasp.rkf, that contain some of the results from the VASP calculation. If the AMSJob subdirectory already exists, the existing ams.rkf and vasp.rkf files will be reused. NOTE: the purpose of loading VASP data this way is to let you call for example job.results.get_energy() etc., not to run new VASP calculations!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">path</span>

        <span class="n">preferred_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># first check if path is a VASP output</span>
        <span class="c1"># in which case call cls._vasp_to_ams, which will return a NEW path</span>
        <span class="c1"># containing ams.rkf and vasp.rkf (the .rkf files will be created if they do not exist)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">preferred_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;ams.rkf&#39;</span><span class="p">))</span> \
                    <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;OUTCAR&#39;</span><span class="p">))</span> \
                    <span class="ow">and</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;vasp&#39;</span> <span class="ow">or</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">vasp_output_to_ams</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;OUTCAR&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;vasp&#39;</span> <span class="ow">or</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span><span class="p">):</span>
            <span class="n">preferred_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">vasp_output_to_ams</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="c1"># check if path is a Quantum ESPRESSO .out file</span>
            <span class="c1"># qe_output_to_ams returns a NEW path containng the ams.rkf and qe.rkf files (will be created if</span>
            <span class="c1"># they do not exist)</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span><span class="s1">&#39;qe&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;rkf&#39;</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">qe_output_to_ams</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># several types of exceptions can be raised, e.g. StopIteration and UnicodeDecodeError</span>
                    <span class="c1"># assume that any exception means that the file was not a QE output file</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;.results&#39;</span><span class="p">):</span>
                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;.results&#39;</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;results&#39;</span><span class="p">):</span>
                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;results&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileError</span><span class="p">(</span><span class="s1">&#39;Path </span><span class="si">{}</span><span class="s1"> does not exist, cannot load from it.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="n">job</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AMSJob</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">load_external</span><span class="p">(</span> <span class="n">path</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">molecule</span><span class="p">,</span> <span class="n">finalize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">preferred_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">preferred_name</span>

        <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.results&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">job</span></div>


<div class="viewcode-block" id="AMSJob.from_inputfile"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.from_inputfile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_inputfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">heredoc_delimit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;eor&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;AMSJob&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct an :class:`AMSJob` instance from an ADF inputfile or runfile.</span>

<span class="sd">        If a runscript is provide than this method will attempt to extract the input file based</span>
<span class="sd">        on the heredoc delimiter (see *heredoc_delimit*).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scm.input_parser</span> <span class="k">import</span> <span class="n">InputParser</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># Try to load the parser from $AMSHOME/scripting</span>
            <span class="k">with</span> <span class="n">UpdateSysPath</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">scm.input_parser</span> <span class="k">import</span> <span class="n">InputParser</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">inp_file</span> <span class="o">=</span> <span class="n">parse_heredoc</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">heredoc_delimit</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">InputParser</span><span class="p">()</span> <span class="k">as</span> <span class="n">parser</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">to_settings</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_command</span><span class="p">,</span> <span class="n">inp_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JobError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;from_inputfile: failed to parse &#39;</span><span class="si">{filename}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Extract a molecule from the input settings</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">settings_to_mol</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># Create and return the Job instance</span>
        <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">molecule</span><span class="o">=</span><span class="n">mol</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">ignore_molecule</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AMSJob.settings_to_mol"><a class="viewcode-back" href="../../../../../interfaces/ams.html#scm.plams.interfaces.adfsuite.ams.AMSJob.settings_to_mol">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">settings_to_mol</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">Settings</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Pop the `s.input.ams.system` block from a settings instance and convert it into a dictionary of molecules.</span>

<span class="sd">        The provided settings should be in the same style as the ones produced by the SCM input parser.</span>
<span class="sd">        Dictionary keys are taken from the header of each system block.</span>
<span class="sd">        The existing `s.input.ams.system` block is removed in the process, assuming it was present in the first place.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">read_mol</span><span class="p">(</span><span class="n">settings_block</span><span class="p">:</span> <span class="n">Settings</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Molecule</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;Retrieve single molecule from a single `s.input.ams.system` block.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;geometryfile&#39;</span> <span class="ow">in</span> <span class="n">settings_block</span><span class="p">:</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">settings_block</span><span class="o">.</span><span class="n">geometryfile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">_1</span><span class="p">:</span>
                    <span class="c1"># Extract arguments for Atom()</span>
                    <span class="n">symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">*</span><span class="n">comment</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">comment</span> <span class="k">else</span> <span class="p">{</span><span class="s1">&#39;suffix&#39;</span><span class="p">:</span> <span class="n">comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">at</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">PTError</span><span class="p">:</span>  <span class="c1"># It&#39;s either a ghost atom and/or an atom with a custom name</span>
                        <span class="k">if</span> <span class="n">symbol</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Gh.&#39;</span><span class="p">):</span>  <span class="c1"># Ghost atom</span>
                            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ghost&#39;</span><span class="p">],</span> <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>  <span class="c1"># Atom with a custom name</span>
                            <span class="n">symbol</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">at</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                    <span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

                <span class="c1"># Set the lattice vector if applicable</span>
                <span class="k">if</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">_1</span><span class="p">:</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">_1</span><span class="p">]</span>

            <span class="c1"># Add bonds</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">bondorders</span><span class="o">.</span><span class="n">_1</span><span class="p">:</span>
                <span class="n">_at1</span><span class="p">,</span> <span class="n">_at2</span><span class="p">,</span> <span class="n">_order</span><span class="p">,</span> <span class="o">*</span><span class="n">bondprops</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">at1</span><span class="p">,</span> <span class="n">at2</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">_at1</span><span class="p">)],</span> <span class="n">mol</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">_at2</span><span class="p">)],</span> <span class="nb">float</span><span class="p">(</span><span class="n">_order</span><span class="p">)</span>
                <span class="n">plams_bond</span> <span class="o">=</span> <span class="n">Bond</span><span class="p">(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
                <span class="c1"># Add bond properties as string if present (used in ACErxn)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bondprops</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bondprops</span><span class="p">)</span>
                    <span class="n">plams_bond</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span>
                <span class="n">mol</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span><span class="n">plams_bond</span><span class="p">)</span>

            <span class="c1"># Set the molecular charge</span>
            <span class="k">if</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">charge</span><span class="p">:</span>
                <span class="n">mol</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">settings_block</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>

            <span class="c1"># Set the region info (used in ACErxn)</span>
            <span class="k">if</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">region</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">s_reg</span> <span class="ow">in</span> <span class="n">settings_block</span><span class="o">.</span><span class="n">region</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;_h&#39;</span> <span class="ow">in</span> <span class="n">s_reg</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="k">raise</span> <span class="n">PlamsError</span> <span class="p">(</span><span class="s1">&#39;Region block requires a header!&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s_reg</span><span class="o">.</span><span class="n">properties</span> <span class="p">:</span>
                        <span class="n">mol</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">s_reg</span><span class="o">.</span><span class="n">_h</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_reg</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">_1</span>

            <span class="n">mol</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings_block</span><span class="o">.</span><span class="n">_h</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mol</span>

        <span class="c1"># Raises a KeyError if the `system` key is absent</span>
        <span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">suppress_missing</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">settings_list</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">ams</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># The block s.input.ams.system is absent</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Create a new dictionary with system headers as keys and molecules as values</span>
        <span class="n">moldict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">settings_block</span> <span class="ow">in</span> <span class="n">settings_list</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings_block</span><span class="o">.</span><span class="n">_h</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_h&#39;</span> <span class="ow">in</span> <span class="n">settings_block</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="c1"># Empty string used as default system name.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">moldict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Duplicate system headers found in s.input.ams.system: {repr(key)}&quot;</span><span class="p">)</span>
            <span class="n">moldict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_mol</span><span class="p">(</span><span class="n">settings_block</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">moldict</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_slurm_env</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Produce a string with environment variables declaration needed for running AMS on a SLURM managed system.</span>

<span class="sd">        If the key ``slurm`` is present in ``settings.run`` and it&#39;s ``True`` the returned string is of the form:</span>

<span class="sd">        ``export SCM_MPIOPTIONS=&quot;-n X -N Y\n&quot;</span>

<span class="sd">        ``X`` is taken from ``settings.run.cores`` (if not present, falls back to ``settings.runscript.nproc``).</span>
<span class="sd">        ``Y`` is taken from ``settings.run.nodes``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;slurm&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">run</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">slurm</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">slurmenv</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;cores&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">run</span><span class="p">:</span>
                <span class="n">slurmenv</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;-n </span><span class="si">{settings.run.cores}</span><span class="s1"> &#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;nproc&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">runscript</span><span class="p">:</span>
                <span class="n">slurmenv</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;-n </span><span class="si">{settings.runscript.nproc}</span><span class="s1"> &#39;</span>
            <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">run</span><span class="p">:</span>
                <span class="n">slurmenv</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;-N </span><span class="si">{settings.run.nodes}</span><span class="s1"> &#39;</span>
            <span class="k">if</span> <span class="n">slurmenv</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;export SCM_MPIOPTIONS=&quot;</span><span class="si">{slurmenv}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>
</pre></div>

           </div>
          </div>
          <!--STARTNOSOLR-->
<footer>
  

  <hr/> 

<!-- start :: footer -->
		<footer class="site-footer block">
			<div class="container">
				<div class="row">
					<div class="footer-column" >
	<ul>
		<li id="nav_menu-2" class="widget widget_nav_menu "><h3>Application Areas</h3><div class="menu-application-areas-container"><ul id="menu-application-areas" class="menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/batteries/">Batteries &#038; PVs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/chemical-bonding-analysis/">Bonding Analysis</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/catalysis/">Catalysis</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/heavy-elements/">Heavy Elements</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/inorganic-chemistry/">Inorganic Chemistry</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/pharma/">Life Sciences</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/materials-science/">Materials Science</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/nanotechnology/">Nanotechnology</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/oil-and-gas/">Oil and Gas</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/organic-electronics/">Organic Electronics</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/polymers/">Polymers</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/spectroscopy/">Spectroscopy</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/applications/teaching/">Teaching</a></li>
</ul></div></li>	</ul>
</div><div class="footer-column" >
	<ul>
		<li id="nav_menu-7" class="widget widget_nav_menu "><h3>Products</h3><div class="menu-product-navigation-container"><ul id="menu-product-navigation" class="menu">
<li id="menu-item-40263" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-40263"><a href="https://www.scm.com/product/ams/">AMS Driver</a></li>
<li id="menu-item-7235" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7235"><a href="https://www.scm.com/product/adf/">ADF</a></li>
<li id="menu-item-7236" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7236"><a href="https://www.scm.com/product/band_periodicdft/">BAND</a></li>
<li id="menu-item-7237" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7237"><a href="https://www.scm.com/product/cosmo-rs/">COSMO-RS</a></li>
<li id="menu-item-7238" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7238"><a href="https://www.scm.com/product/dftb/">DFTB</a></li>
<li id="menu-item-7239" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7239"><a href="https://www.scm.com/product/gui/">GUI</a></li>
<li id="menu-item-44383" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-44383"><a href="https://www.scm.com/product/machine-learning-potentials/">MLPotential</a></li>
<li id="menu-item-7240" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7240"><a href="https://www.scm.com/product/mopac/">MOPAC</a></li>
<li id="menu-item-40262" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-40262"><a href="https://www.scm.com/product/plams/">PLAMS</a></li>
<li id="menu-item-43701" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-43701"><a href="https://www.scm.com/product/quantum-espresso/">Quantum ESPRESSO</a></li>
<li id="menu-item-7241" class="menu-item menu-item-type-post_type menu-item-object-product menu-item-7241"><a href="https://www.scm.com/product/reaxff/">ReaxFF</a></li></ul></div></li><li id="nav_menu-26" class="widget widget_nav_menu "><div class="menu-licensing-container"><ul id="menu-licensing" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/pricing-licensing/">Pricing &#038; Licensing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/pricing-licensing/price-quote/">Price Quote</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/pricing-licensing/price-quote/calculate-your-price/">Price Calculator</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/consulting/">Scientific Consulting</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/pricing-licensing/adf-resellers/">Resellers</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/pricing-licensing/scm-license-terms/">License Terms</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/pricing-licensing/ordering-procedure/">Ordering</a></li>
</ul></div></li>	</ul>
</div><div class="footer-column" >
	<ul>
		<li id="nav_menu-6" class="widget widget_nav_menu "><h3>Support</h3><div class="menu-support-navigation-container"><ul id="menu-support-navigation" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/support/">Support Overview</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/support/ams-installation-videos/">Installation</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/support/ams-tutorials-and-manuals/">Documentation</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/doc/Tutorials/GUI_overview/GUI_overview_tutorials.html">GUI Tutorials</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/support/downloads/">Downloads</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/faq/">FAQs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/adf-discussion-list/">Discussion List</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/support/documentation-previous-versions/release-notes/">Release Notes</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/support/adf-teaching-materials/">Teaching Materials</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/news-agenda/adf-hands-on-workshops/">Workshops</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/news-agenda/web-presentations-by-adf-experts/">Webinars</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/videos-tutorials-and-web-presentations/">Videos</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/amsterdam-modeling-suite/brochures/">Brochure</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/amsterdam-modeling-suite/research-papers-citing-adf/">Papers Citing ADF</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/category/highlights/">Literature Highlights</a></li>
</ul></div></li>	</ul>
</div><div class="footer-column" >
	<ul>
		<li id="nav_menu-28" class="widget widget_nav_menu "><h3>About Us</h3><div class="menu-about-us-container"><ul id="menu-about-us" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/contact-us/">Contact Us</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/eu-projects/">EU Projects</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/our-authors/">Contributors</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/our-people/">The SCM Team</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/collaborations/">Collaborations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/careers/">Careers</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/mission-vision/">Mission &#038; Vision</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/newsletters/">Newsletters</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://www.scm.com/category/news/">News</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.scm.com/about-us/news-agenda/">Events</a></li>
</ul></div></li>	</ul>
</div><div class="footer-column" >
	<ul>
			</ul>
</div>				</div>
			</div>
		</footer>
		<footer class="disclaimer-footer">
			<img src="https://www.scm.com/wp-content/themes/scm/images/logos/scm-logo-compact.svg" alt="">
			<nav class="menu-service-navigation-container"><ul id="menu-service-navigation" class="menu-service navbar-nav"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-73"><a href="https://www.scm.com/copyright/">Copyright</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-72"><a href="https://www.scm.com/terms-of-use/">Terms of Use</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-71"><a href="https://www.scm.com/privacy-policy/">Privacy Policy</a></li>
</ul></nav></footer>	
		<!-- end :: footer -->

<!--ENDNOSOLR-->
        </div>
      </div>

    </section>
  </div>
  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'2021.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCRWHZZ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
      <script type="text/javascript" src="../../../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
      <script type="text/javascript" src="../../../../../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../../../../../_static/../../MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>